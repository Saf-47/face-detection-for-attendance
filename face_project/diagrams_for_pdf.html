<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Face Recognition Project - Diagrams</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
        }
        h1 {
            text-align: center;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
        }
        h2 {
            margin-top: 50px;
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
        }
        .diagram-container {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #eee;
            border-radius: 8px;
            display: flex;
            justify-content: center;
        }
        /* Print optimizations */
        @media print {
            .page-break {
                page-break-before: always;
            }
            .no-print {
                display: none;
            }
            body {
                margin: 0;
                max-width: 100%;
            }
            .diagram-container {
                border: none;
            }
        }
    </style>
</head>
<body>

    <div class="no-print" style="background-color: #e8f0fe; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
        <strong>Instructions:</strong>
        <ol>
            <li>Wait for the diagrams to render below.</li>
            <li>Press <strong>Ctrl + P</strong> (or Cmd + P).</li>
            <li>Select <strong>"Save as PDF"</strong> or "Microsoft Print to PDF" as the destination.</li>
            <li>Click Save.</li>
        </ol>
    </div>

    <h1>Face Recognition Attendance System - Diagrams</h1>

    <h2>1. System Architecture (Data Flow)</h2>
    <div class="diagram-container">
        <div class="mermaid">
flowchart TD
    subgraph Enrollment Phase
        A[Training Videos] -->|extract_frames.py| B[Face Dataset]
        B -->|make_embeddings.py| C[InsightFace Model]
        C --> D[Embeddings Database]
    end

    subgraph Inference Phase
        E[Webcam Input] -->|Capture Frame| F[Face Detection]
        F -->|Crop & Align| G[Face Recognition]
        G -->|Generate Vector| H[Live Embedding]
        
        H -->|Cosine Similarity| I{Match Found?}
        D --> I
        
        I -- Yes (>0.50) --> J[Tracker Update]
        I -- No --> K[Mark Unknown]
        
        J --> L{Confirmed?}
        L -- Yes (>30s) --> M[Log to CSV]
        L -- No --> N[Continue Tracking]
    end
        </div>
    </div>

    <div class="page-break"></div>

    <h2>2. Sequence Diagram (Runtime Logic)</h2>
    <div class="diagram-container">
        <div class="mermaid">
sequenceDiagram
    participant User
    participant Camera
    participant Detector
    participant Recognizer
    participant Tracker
    participant CSV

    User->>Camera: Stands in front
    Camera->>Detector: Send Frame
    Detector->>Recognizer: Detected Face (BBox + Landmarks)
    Recognizer->>Tracker: Face Embedding (512-d)
    
    activate Tracker
    Tracker->>Tracker: Match with Reference DB
    Tracker->>Tracker: Update Track History
    Tracker->>Tracker: Check Consistency (30s window)
    
    alt Confirmed
        Tracker->>CSV: Log Attendance (Name, Time)
        Tracker-->>User: Show Green Box (Confirmed)
    else Verifying
        Tracker-->>User: Show Yellow Box (Verifying...)
    end
    deactivate Tracker
        </div>
    </div>

    <div class="page-break"></div>

    <h2>3. State Machine (Person Tracking)</h2>
    <div class="diagram-container">
        <div class="mermaid">
stateDiagram-v2
    [*] --> Tracking: New Face Detected
    
    state Tracking {
        [*] --> Accumulating: Add Frame to History
        Accumulating --> CheckThresholds: Is Similarity > 0.5?
        CheckThresholds --> Accumulating: No
        CheckThresholds --> ValidFrame: Yes
    }

    Tracking --> Confirmed: Consistency > 60% (after 30s)
    Tracking --> Lost: Face Lost (> 2s gap)
    
    Confirmed --> [*]: Logged & Finished
    Lost --> [*]: Delete Track
        </div>
    </div>

    <div class="page-break"></div>

    <h2>4. Class Diagram</h2>
    <div class="diagram-container">
        <div class="mermaid">
classDiagram
    class ReferenceDatabase {
        +embeddings: numpy.array
        +labels: list
        +find_match(embedding) (name, score)
    }

    class PersonTrack {
        +track_id: int
        +history: list
        +status: str
        +update(embedding, bbox)
        +check_confirmation() bool
    }

    class Tracker {
        +tracks: list[PersonTrack]
        +update(faces, db)
    }

    class CsvLogger {
        +filename: str
        +append_row(data)
    }

    Tracker "1" *-- "*" PersonTrack : manages
    Tracker ..> ReferenceDatabase : uses
    Tracker ..> CsvLogger : uses
        </div>
    </div>

</body>
</html>
